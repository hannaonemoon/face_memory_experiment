<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="https://unpkg.com/jspsych@8.0.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@2.0.0"></script>
    <link href="https://unpkg.com/jspsych@8.0.3/css/jspsych.css" rel="stylesheet" type="text/css" />
  </head>
  <body></body>
  <script type="module">
    const jsPsych = initJsPsych();

    // Function that randomly shuffles an array.
    const shuffle = jsPsych.randomization.shuffle;

    // Update these values to change the delay for certain trials
    const NAME_DELAY = 2000;
    const IMAGE_DELAY = 3000;
    const BIO_DELAY = 4000;
    const MATH_DELAY = 4000;
    const IMAGE_WIDTH = 500;

    class RandomPool {
      #values;
      #occurrence;
      #pickedValues = new Map();

      constructor(occurrence, values) {
        this.#occurrence = occurrence;
        this.#values = [...values];
      }

      pickRandomValue() {
        if (this.#values.length === 0) {
          throw new Error('Pool is empty');
        }

        const index = Math.floor(Math.random() * this.#values.length);
        const value = this.#values[index];
        const numberOfOccurrence = (this.#pickedValues.get(value) ?? 0) + 1;

        if (numberOfOccurrence >= this.#occurrence) {
          this.#values.splice(index, 1);
        }

        this.#pickedValues.set(value, numberOfOccurrence);

        return value;
      }
    }

    const mathPool = new RandomPool(2, [
      { expression: '2 + 3', answer: '5' },
      { expression: '5 + 1 ', answer: '6' },
      { expression: '1 + 2 ', answer: '3' },
      { expression: '1 + 3 ', answer: '4' },
      { expression: '7 + 2 ', answer: '9' },
      { expression: '1 + 5 ', answer: '6' },
      { expression: '1 + 1 ', answer: '2' },
      { expression: '6 + 1 ', answer: '7' },
      { expression: '0 + 5 ', answer: '5' },
      { expression: '6 + 2 ', answer: '8' },
      { expression: '0 + 2 ', answer: '2' },
      { expression: '3 + 2 ', answer: '5' },
      { expression: '1 + 5 ', answer: '6' },
      { expression: '6 + 2 ', answer: '8' },
      { expression: '1 + 2 ', answer: '3' },
      { expression: '5 + 2 ', answer: '7' },
      { expression: '3 + 5 ', answer: '8' },
      { expression: '5 + 2 ', answer: '7' },
      { expression: '5 - 3', answer: '2' },
      { expression: '8 - 6', answer: '2' },
      { expression: '4 - 0', answer: '4' },
      { expression: '6 - 1', answer: '5' },
      { expression: '8 - 8', answer: '0' },
      { expression: '8 - 0', answer: '8' },
      { expression: '9 - 0', answer: '9' },
      { expression: '2 - 1', answer: '1' },
      { expression: '6 - 0', answer: '6' },
      { expression: '5 - 3', answer: '2' },
      { expression: '5 - 1', answer: '4' },
      { expression: '7 - 2', answer: '5' },
      { expression: '9 - 5', answer: '4' },
      { expression: '7 - 4', answer: '3' },
      { expression: '1 - 0', answer: '1' },
      { expression: '4 - 2', answer: '2' },
      { expression: '6 - 2', answer: '4' },
      { expression: '5 - 5', answer: '0' },
    ]);

    const maleNamePool = new RandomPool(2, [
      'Jacob',
      'Michael',
      'Joshua',
      'Matthew',
      'Daniel',
      'Christopher',
      'Andrew',
      'Ethan',
      'Joseph',
      'William',
      'Anthony',
      'David',
      'Alexander',
      'Nicholas',
      'Ryan',
      'Tyler',
      'James',
      'John',
      'Jonathan',
      'Noah',
      'Brandon',
      'Christian',
      'Dylan',
      'Samuel',
      'Benjamin',
      'Nathan',
      'Zachary',
      'Logan',
      'Justin',
      'Gabriel',
      'Jose',
      'Austin',
      'Kevin',
      'Elijah',
      'Caleb',
      'Robert',
      'Thomas',
      'Jordan',
      'Cameron',
      'Jack',
      'Hunter',
      'Jackson',
      'Angel',
      'Isaiah',
      'Evan',
      'Isaac',
      'Luke',
      'Mason',
      'Jayden',
      'Jason',
      'Gavin',
      'Aaron',
      'Connor',
      'Aiden',
    ]);

    const femaleNamePool = new RandomPool(2, [
      'Emily',
      'Madison',
      'Emma',
      'Olivia',
      'Hannah',
      'Abigail',
      'Isabella',
      'Samantha',
      'Elizabeth',
      'Ashley',
      'Alexis',
      'Sarah',
      'Sophia',
      'Alyssa',
      'Grace',
      'Ava',
      'Taylor',
      'Brianna',
      'Lauren',
      'Chloe',
      'Natalie',
      'Kayla',
      'Jessica',
      'Anna',
      'Victoria',
      'Mia',
      'Hailey',
      'Sydney',
      'Jasmine',
      'Julia',
      'Morgan',
      'Destiny',
      'Rachel',
      'Ella',
      'Kaitlyn',
      'Megan',
      'Katherine',
      'Savannah',
      'Jennifer',
      'Alexandra',
      'Allison',
      'Haley',
      'Maria',
      'Kaylee',
      'Lily',
      'Makayla',
      'Brooke',
      'Nicole',
      'Mackenzie',
      'Addison',
      'Stephanie',
      'Lillian',
      'Andrea',
      'Faith',
    ]);

    const positiveBehaviorsPool = new RandomPool(1, [
      'brings homemade meals for the team when work gets hectic.',
      'helps neighbors carry large boxes up multiple flights without hesitation.',
      'spends weekends volunteering at the local animal shelter with enthusiasm.',
      'offers up a bus seat to someone standing, without being asked.',
      'throws surprise birthday parties, complete with balloons and thoughtful gifts.',
      'stays late to help friends finish up big projects.',
      'checks in on friends feeling down, calling to brighten their day.',
      'prepares hearty dinners for family when someone feels under the weather.',
      'surprises coworkers with coffee on busy mornings to boost morale. ',
    ]);

    const negativeBehaviorsPool = new RandomPool(1, [
      'interrupts others during meetings, taking over conversations without notice.',
      'avoids helping friends who carry heavy groceries up long staircases.',
      'ignores group messages that ask for help organizing events.',
      'takes calls loudly at dinner, distracting everyone eating nearby.',
      'borrows items from friends and returns them noticeably damaged.',
      'cuts in line at crowded caf√©s, frustrating everyone waiting behind.',
      'refuses to lower loud music while others try to study.',
      "leaves trash on tables after lunch, ignoring others' requests to clean.",
      'frequently speaks over others in group discussions, disregarding their input',
    ]);

    const neutralBehaviorsPool = new RandomPool(1, [
      'strolls around the block after lunch daily to clear their mind.',
      'reads mystery novels in the park every Sunday, rain or shine.',
      'watches nature documentaries after dinner each night to relax.',
      'cooks fresh pasta dinners on Sunday evenings as a weekend treat.',
      'rearranges the bedroom closet on Saturdays to keep things organized.',
      'goes grocery shopping weekly to stock up on fresh ingredients.',
      'takes the car to the wash every weekend to keep it spotless.',
      'spends an hour rearranging living room furniture to refresh the space.',
      'organizes a collection of potted plants on the balcony every few weeks for a fresh look.',
    ]);

    const asianMaleImages = [
      './images/AM-201.jpg',
      './images/AM-202.jpg',
      './images/AM-207.jpg',
      './images/AM-211.jpg',
      './images/AM-221.jpg',
      './images/AM-229.jpg',
      './images/AM-231.jpg',
      './images/AM-237.jpg',
      './images/AM-252.jpg',
    ];

    const asianMaleImagesPool = new RandomPool(1, asianMaleImages);

    const latinoMaleImages = [
      './images/LM-200.jpg',
      './images/LM-207.jpg',
      './images/LM-208.jpg',
      './images/LM-210.jpg',
      './images/LM-223.jpg',
      './images/LM-231.jpg',
      './images/LM-239.jpg',
      './images/LM-241.jpg',
      './images/LM-243.jpg',
    ];

    const latinoMaleImagesPool = new RandomPool(1, latinoMaleImages);

    const whiteMaleImages = [
      './images/WM-004.jpg',
      './images/WM-009.jpg',
      './images/WM-031.jpg',
      './images/WM-033.jpg',
      './images/WM-036.jpg',
      './images/WM-040.jpg',
      './images/WM-200.jpg',
      './images/WM-208.jpg',
      './images/WM-209.jpg',
    ];

    const whiteMaleImagesPool = new RandomPool(1, whiteMaleImages);

    const asianFemaleImages = [
      './images/AF-205.jpg',
      './images/AF-219.jpg',
      './images/AF-225.jpg',
      './images/AF-226.jpg',
      './images/AF-227.jpg',
      './images/AF-228.jpg',
      './images/AF-244.jpg',
      './images/AF-252.jpg',
      './images/AF-255.jpg',
    ];

    const asianFemaleImagesPool = new RandomPool(1, asianFemaleImages);

    const latinaFemaleImages = [
      './images/LF-201.jpg',
      './images/LF-209.jpg',
      './images/LF-211.jpg',
      './images/LF-212.jpg',
      './images/LF-213.jpg',
      './images/LF-241.jpg',
      './images/LF-243.jpg',
      './images/LF-247.jpg',
      './images/LF-251.jpg',
    ];

    const latinaFemaleImagesPool = new RandomPool(1, latinaFemaleImages);

    const whiteFemaleImages = [
      './images/WF-007.jpg',
      './images/WF-017.jpg',
      './images/WF-027.jpg',
      './images/WF-206.jpg',
      './images/WF-207.jpg',
      './images/WF-214.jpg',
      './images/WF-233.jpg',
      './images/WF-235.jpg',
      './images/WF-244.jpg',
    ];

    const whiteFemaleImagesPool = new RandomPool(1, whiteFemaleImages);

    function createRandomMathTrial() {
      const { expression, answer } = mathPool.pickRandomValue();

      return [
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: `<p>${expression} = ?</p>`,
          choices: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'],
          trial_duration: MATH_DELAY,
          data: { expression, answer },
          on_finish(data) {
            // Score the keyboard response as correct or incorrect.
            data.correct = jsPsych.pluginAPI.compareKeys(data.response, answer);
          },
        },
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus() {
            const lastTrial = jsPsych.data.get().last(1).values()[0];

            return `<p>${expression} = ${answer}</p><p>${lastTrial.correct ? 'Correct!' : 'Wrong.'}</p>`;
          },
          choices: 'NO_KEYS',
          trial_duration() {
            const lastTrial = jsPsych.data.get().last(1).values()[0];
            const BASE_FEEDBACK_TIME = 1000;
            // Currently always shows feedback for 1 second + any extra time left over
            if (lastTrial.rt === null) return 1000;

            return MATH_DELAY - lastTrial.rt + BASE_FEEDBACK_TIME;
          },
        },
      ];
    }

    // Helper to general a biography-first trial.
    function createBioFirstTrial(name, behavior, image) {
      return [
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: name,
          choices: 'NO_KEYS',
          trial_duration: NAME_DELAY,
          data: { name },
        },
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: `${name} ${behavior}`,
          choices: 'NO_KEYS',
          trial_duration: BIO_DELAY,
          data: { behavior },
        },
        {
          type: jsPsychImageKeyboardResponse,
          stimulus: image,
          stimulus_width: IMAGE_WIDTH,
          choices: 'NO_KEYS',
          trial_duration: IMAGE_DELAY,
          data: { image },
        },
        ...createRandomMathTrial(),
      ];
    }

    // Helper to general a face-first trial.
    function createFaceFirstTrial(name, behavior, image) {
      return [
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: name,
          choices: 'NO_KEYS',
          trial_duration: NAME_DELAY,
          data: { name },
        },
        {
          type: jsPsychImageKeyboardResponse,
          stimulus: image,
          stimulus_width: IMAGE_WIDTH,
          choices: 'NO_KEYS',
          trial_duration: IMAGE_DELAY,
          data: { image },
        },
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: `${name} ${behavior}`,
          choices: 'NO_KEYS',
          trial_duration: BIO_DELAY,
          data: { behavior },
        },
        ...createRandomMathTrial(),
      ];
    }

    // Helper to general a control trial.
    function createControlTrail(name, image) {
      return [
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: name,
          choices: 'NO_KEYS',
          trial_duration: NAME_DELAY,
        },
        {
          type: jsPsychImageKeyboardResponse,
          stimulus: image,
          stimulus_width: IMAGE_WIDTH,
          choices: 'NO_KEYS',
          trial_duration: IMAGE_DELAY,
        },
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: name,
          choices: 'NO_KEYS',
          trial_duration: NAME_DELAY,
        },
        ...createRandomMathTrial(),
      ];
    }

    function sequenceLearningPhase() {
      // Lets assume the length of each pool is the same as this constant.
      const numberOfTrials = 18;
      // A list of randomized pools, one for each condition.
      // You'll have to update this hardcoded list (or generate it) with the proper names and descriptions.
      // Images are assumed to be in an `/img` folder in the same directory as this HTML file and labeled with the names of person display.
      const pools = [
        shuffle([
          createControlTrail(maleNamePool.pickRandomValue(), asianMaleImagesPool.pickRandomValue()),
          createControlTrail(maleNamePool.pickRandomValue(), asianMaleImagesPool.pickRandomValue()),
          createControlTrail(maleNamePool.pickRandomValue(), asianMaleImagesPool.pickRandomValue()),
          createControlTrail(maleNamePool.pickRandomValue(), latinoMaleImagesPool.pickRandomValue()),
          createControlTrail(maleNamePool.pickRandomValue(), latinoMaleImagesPool.pickRandomValue()),
          createControlTrail(maleNamePool.pickRandomValue(), latinoMaleImagesPool.pickRandomValue()),
          createControlTrail(maleNamePool.pickRandomValue(), whiteMaleImagesPool.pickRandomValue()),
          createControlTrail(maleNamePool.pickRandomValue(), whiteMaleImagesPool.pickRandomValue()),
          createControlTrail(maleNamePool.pickRandomValue(), whiteMaleImagesPool.pickRandomValue()),
          createControlTrail(femaleNamePool.pickRandomValue(), asianFemaleImagesPool.pickRandomValue()),
          createControlTrail(femaleNamePool.pickRandomValue(), asianFemaleImagesPool.pickRandomValue()),
          createControlTrail(femaleNamePool.pickRandomValue(), asianFemaleImagesPool.pickRandomValue()),
          createControlTrail(femaleNamePool.pickRandomValue(), latinaFemaleImagesPool.pickRandomValue()),
          createControlTrail(femaleNamePool.pickRandomValue(), latinaFemaleImagesPool.pickRandomValue()),
          createControlTrail(femaleNamePool.pickRandomValue(), latinaFemaleImagesPool.pickRandomValue()),
          createControlTrail(femaleNamePool.pickRandomValue(), whiteFemaleImagesPool.pickRandomValue()),
          createControlTrail(femaleNamePool.pickRandomValue(), whiteFemaleImagesPool.pickRandomValue()),
          createControlTrail(femaleNamePool.pickRandomValue(), whiteFemaleImagesPool.pickRandomValue()),
        ]),
        shuffle([
          createFaceFirstTrial(
            maleNamePool.pickRandomValue(),
            asianMaleImagesPool.pickRandomValue(),
            neutralBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            maleNamePool.pickRandomValue(),
            asianMaleImagesPool.pickRandomValue(),
            negativeBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            maleNamePool.pickRandomValue(),
            asianMaleImagesPool.pickRandomValue(),
            positiveBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            maleNamePool.pickRandomValue(),
            latinoMaleImagesPool.pickRandomValue(),
            neutralBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            maleNamePool.pickRandomValue(),
            latinoMaleImagesPool.pickRandomValue(),
            negativeBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            maleNamePool.pickRandomValue(),
            latinoMaleImagesPool.pickRandomValue(),
            positiveBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            maleNamePool.pickRandomValue(),
            whiteMaleImagesPool.pickRandomValue(),
            neutralBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            maleNamePool.pickRandomValue(),
            whiteMaleImagesPool.pickRandomValue(),
            negativeBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            maleNamePool.pickRandomValue(),
            whiteMaleImagesPool.pickRandomValue(),
            positiveBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            femaleNamePool.pickRandomValue(),
            asianFemaleImagesPool.pickRandomValue(),
            neutralBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            femaleNamePool.pickRandomValue(),
            asianFemaleImagesPool.pickRandomValue(),
            negativeBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            femaleNamePool.pickRandomValue(),
            asianFemaleImagesPool.pickRandomValue(),
            positiveBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            femaleNamePool.pickRandomValue(),
            latinaFemaleImagesPool.pickRandomValue(),
            neutralBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            femaleNamePool.pickRandomValue(),
            latinaFemaleImagesPool.pickRandomValue(),
            negativeBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            femaleNamePool.pickRandomValue(),
            latinaFemaleImagesPool.pickRandomValue(),
            positiveBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            femaleNamePool.pickRandomValue(),
            whiteFemaleImagesPool.pickRandomValue(),
            neutralBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            femaleNamePool.pickRandomValue(),
            whiteFemaleImagesPool.pickRandomValue(),
            negativeBehaviorsPool.pickRandomValue()
          ),
          createFaceFirstTrial(
            femaleNamePool.pickRandomValue(),
            whiteFemaleImagesPool.pickRandomValue(),
            positiveBehaviorsPool.pickRandomValue()
          ),
        ]),
        shuffle([
          createBioFirstTrial(
            maleNamePool.pickRandomValue(),
            asianMaleImagesPool.pickRandomValue(),
            neutralBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            maleNamePool.pickRandomValue(),
            asianMaleImagesPool.pickRandomValue(),
            negativeBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            maleNamePool.pickRandomValue(),
            asianMaleImagesPool.pickRandomValue(),
            positiveBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            maleNamePool.pickRandomValue(),
            latinoMaleImagesPool.pickRandomValue(),
            neutralBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            maleNamePool.pickRandomValue(),
            latinoMaleImagesPool.pickRandomValue(),
            negativeBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            maleNamePool.pickRandomValue(),
            latinoMaleImagesPool.pickRandomValue(),
            positiveBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            maleNamePool.pickRandomValue(),
            whiteMaleImagesPool.pickRandomValue(),
            neutralBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            maleNamePool.pickRandomValue(),
            whiteMaleImagesPool.pickRandomValue(),
            negativeBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            maleNamePool.pickRandomValue(),
            whiteMaleImagesPool.pickRandomValue(),
            positiveBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            femaleNamePool.pickRandomValue(),
            asianFemaleImagesPool.pickRandomValue(),
            neutralBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            femaleNamePool.pickRandomValue(),
            asianFemaleImagesPool.pickRandomValue(),
            negativeBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            femaleNamePool.pickRandomValue(),
            asianFemaleImagesPool.pickRandomValue(),
            positiveBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            femaleNamePool.pickRandomValue(),
            latinaFemaleImagesPool.pickRandomValue(),
            neutralBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            femaleNamePool.pickRandomValue(),
            latinaFemaleImagesPool.pickRandomValue(),
            negativeBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            femaleNamePool.pickRandomValue(),
            latinaFemaleImagesPool.pickRandomValue(),
            positiveBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            femaleNamePool.pickRandomValue(),
            whiteFemaleImagesPool.pickRandomValue(),
            neutralBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            femaleNamePool.pickRandomValue(),
            whiteFemaleImagesPool.pickRandomValue(),
            negativeBehaviorsPool.pickRandomValue()
          ),
          createBioFirstTrial(
            femaleNamePool.pickRandomValue(),
            whiteFemaleImagesPool.pickRandomValue(),
            positiveBehaviorsPool.pickRandomValue()
          ),
        ]),
      ];

      const sequence = [];

      // Interleave the pools together, but make sure there are at most 2 repeating conditions.
      for (let i = 0; i < numberOfTrials; i++) {
        sequence.push(...shuffle(pools.map((pool) => pool[i])));
      }

      // Flatten the sequence out into a single array for jspsych.
      return sequence.flat();
    }

    const timeline = sequenceLearningPhase();

    // For debugging purposes to see the table of the timeline in the browser's dev tools
    console.table(timeline, ['stimulus', 'duration']);

    jsPsych
      .run([
        {
          type: jsPsychPreload,
          // paths of images to load.
          images: [
            ...asianMaleImages,
            ...latinoMaleImages,
            ...whiteMaleImages,
            ...asianFemaleImages,
            ...latinaFemaleImages,
            ...whiteFemaleImages,
          ],
        },
        {
          type: jsPsychHtmlKeyboardResponse,
          stimulus: 'Welcome to the experiment. Press any key to begin.',
        },
        ...timeline,
      ])
      .then(() => {
        // this code runs when the timeline finishes
        const table = convertTrialDataToTable();
        downloadCSV('trial_result.csv', table);
      });

    function convertTrialDataToTable() {
      const trials = jsPsych.data.get();

      console.log(trials);
      const table = [['index', 'stimulus', 'math_expression', 'math_answer', 'math_correct']];

      // the first trial on the timeline is to preload images
      // for (const trial of trials) {
      //   if (trial.trial_type === 'image-keyboard-response') {
      //     table.push([trial.trial_index, trial.stimulus, '', '', '']);
      //   } else if (trial.trial_type === 'html-keyboard-response') {
      //     table.push([trial.trial_index, trial.stimulus, trial.expression || '', trial.answer, trial.correct]);
      //   }
      // }

      return table;
    }

    function downloadCSV(filename, table) {
      const link = document.createElement('a');
      link.href = encodeURI(`data:text/csv;charset=utf-8,${table.map((e) => e.join(',')).join('\n')}`);
      link.setAttribute('download', filename);
      link.style.display = 'none';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</html>
